<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finesse Email Bulker</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --accent-color: #ea4335;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .tagline {
            color: var(--dark-gray);
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .form-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .preview-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        h3 {
            color: var(--primary-color);
            margin: 15px 0 10px;
            font-size: 1.2rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: block;
            padding: 12px;
            background-color: var(--light-gray);
            border: 2px dashed #ccc;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-label:hover {
            background-color: #e9e9e9;
            border-color: var(--primary-color);
        }
        
        .file-name {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3367d6;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: #2d9249;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #d33426;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .email-container {
            margin-bottom: 30px;
        }
        
        .email-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            background-color: var(--light-gray);
        }
        
        .email-item {
            padding: 8px;
            margin-bottom: 5px;
            background-color: white;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .email-item:last-child {
            margin-bottom: 0;
        }
        
        .email-link {
            color: var(--primary-color);
            text-decoration: none;
            word-break: break-all;
        }
        
        .email-link:hover {
            text-decoration: underline;
        }
        
        .email-link.clicked {
            color: var(--accent-color);
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f0fe;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .stats p {
            margin-bottom: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .help-text {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .input-methods {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-method {
            flex: 1;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .manual-emails {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .method-selector {
            display: flex;
            margin-bottom: 15px;
        }
        
        .method-tab {
            padding: 10px 20px;
            background-color: #eee;
            border: none;
            cursor: pointer;
            border-radius: 4px 4px 0 0;
        }
        
        .method-tab.active {
            background-color: white;
            font-weight: bold;
        }
        
        .input-container {
            display: none;
        }
        
        .input-container.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Finesse Email Bulker</h1>
            <p class="tagline">Efficiently send bulk emails with ease</p>
        </header>
        
        <div class="main-content">
            <section class="form-section">
                <h2>Compose Your Email</h2>
                
                <div class="form-group">
                    <label for="subject">Subject Line</label>
                    <input type="text" id="subject" placeholder="Enter your email subject">
                </div>
                
                <div class="form-group">
                    <label for="message">Message Body</label>
                    <textarea id="message" placeholder="Enter your email message"></textarea>
                    <p class="help-text">Use {name} to personalize the message with recipient's name</p>
                </div>
                
                <div class="method-selector">
                    <button class="method-tab active" data-method="csv">CSV Upload</button>
                    <button class="method-tab" data-method="manual">Manual Entry</button>
                </div>
                
                <div class="input-methods">
                    <div class="input-method">
                        <div id="csvInput" class="input-container active">
                            <label for="csvFile">Upload CSV File</label>
                            <input type="file" id="csvFile" accept=".csv" class="file-input">
                            <label for="csvFile" class="file-label">
                                Choose CSV File
                            </label>
                            <div id="fileName" class="file-name">No file selected</div>
                            <p class="help-text">CSV should contain email addresses. Include 'name' column for personalization.</p>
                        </div>
                        
                        <div id="manualInput" class="input-container">
                            <label for="manualEmails">Enter Emails Manually</label>
                            <textarea id="manualEmails" class="manual-emails" placeholder="Enter emails, one per line or separated by commas"></textarea>
                            <p class="help-text">Enter email addresses, one per line or separated by commas. Add names after emails like: email@example.com, John Doe</p>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="processBtn" class="btn">Process Emails</button>
                    <button id="clearBtn" class="btn btn-accent">Clear All</button>
                </div>
            </section>
            
            <section class="preview-section">
                <h2>Email Preview</h2>
                
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Processing emails...</p>
                </div>
                
                <div id="emailPreview">
                    <p>Upload a CSV file or enter emails manually to preview.</p>
                    
                    <div id="emailLists" class="hidden">
                        <div class="email-container">
                            <h3>Gmail Addresses (<span id="gmailCount">0</span>)</h3>
                            <div id="gmailList" class="email-list"></div>
                            <button class="btn send-gmail-btn">Send Gmail Batch</button>
                        </div>
                        
                        <div class="email-container">
                            <h3>Other Email Addresses (<span id="nonGmailCount">0</span>)</h3>
                            <div id="nonGmailList" class="email-list"></div>
                            <button class="btn send-other-btn">Send Other Emails Batch</button>
                        </div>
                    </div>
                    
                    <div id="stats" class="stats hidden">
                        <p><strong>Total Emails:</strong> <span id="totalEmails">0</span></p>
                        <p><strong>Valid Emails:</strong> <span id="validEmails">0</span></p>
                        <p><strong>Invalid Emails:</strong> <span id="invalidEmails">0</span></p>
                        <p><strong>Gmail Addresses:</strong> <span id="gmailCountStat">0</span></p>
                        <p><strong>Other Addresses:</strong> <span id="nonGmailCountStat">0</span></p>
                        <p><strong>Clicked Emails:</strong> <span id="clickedEmails">0</span></p>
                    </div>
                    
                    <div class="button-group">
                        <button id="copyAllBtn" class="btn btn-secondary hidden">Copy All Emails (BCC)</button>
                        <button id="sendAllBtn" class="btn hidden">Send All Emails</button>
                    </div>
                </div>
            </section>
        </div>
        
        <footer>
            <p>Finesse Email Bulker &copy; <span id="day"></span> | Designed for efficient bulk emailing</p>
        </footer>
    </div>

    <script>
     let day = document.getElementById('day');
     day.innerHTML = new Date().getFullYear();
      document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const elements = {
        csvFileInput: document.getElementById('csvFile'),
        fileNameDisplay: document.getElementById('fileName'),
        processBtn: document.getElementById('processBtn'),
        clearBtn: document.getElementById('clearBtn'),
        copyAllBtn: document.getElementById('copyAllBtn'),
        sendAllBtn: document.getElementById('sendAllBtn'),
        sendGmailBtn: document.querySelector('.send-gmail-btn'),
        sendOtherBtn: document.querySelector('.send-other-btn'),
        emailLists: document.getElementById('emailLists'),
        gmailList: document.getElementById('gmailList'),
        nonGmailList: document.getElementById('nonGmailList'),
        loading: document.getElementById('loading'),
        emailPreview: document.getElementById('emailPreview'),
        stats: document.getElementById('stats'),
        totalEmailsSpan: document.getElementById('totalEmails'),
        validEmailsSpan: document.getElementById('validEmails'),
        invalidEmailsSpan: document.getElementById('invalidEmails'),
        gmailCountSpan: document.getElementById('gmailCount'),
        nonGmailCountSpan: document.getElementById('nonGmailCount'),
        gmailCountStat: document.getElementById('gmailCountStat'),
        nonGmailCountStat: document.getElementById('nonGmailCountStat'),
        clickedEmailsSpan: document.getElementById('clickedEmails'),
        subjectInput: document.getElementById('subject'),
        messageInput: document.getElementById('message'),
        methodTabs: document.querySelectorAll('.method-tab'),
        csvInput: document.getElementById('csvInput'),
        manualInput: document.getElementById('manualInput'),
        manualEmailsTextarea: document.getElementById('manualEmails')
    };

    // Application State
    const state = {
        validEmails: [],
        invalidEmails: [],
        gmailEmails: [],
        nonGmailEmails: [],
        clickedEmails: new Set(),
        subject: '',
        message: '',
        fileName: 'No file selected',
        manualEmails: '',
        activeMethod: 'csv'
    };

    // Initialize the application
    function init() {
        loadState();
        setupEventListeners();
        renderUI();
    }

    // Load state from localStorage
    function loadState() {
        const savedState = localStorage.getItem('finesseEmailBulkerState');
        if (savedState) {
            const parsedState = JSON.parse(savedState);
            
            Object.assign(state, parsedState);
            
            if (Array.isArray(parsedState.clickedEmails)) {
                state.clickedEmails = new Set(parsedState.clickedEmails);
            }
            
            elements.subjectInput.value = state.subject || '';
            elements.messageInput.value = state.message || '';
            elements.fileNameDisplay.textContent = state.fileName || 'No file selected';
            elements.manualEmailsTextarea.value = state.manualEmails || '';
            
            document.querySelector(`.method-tab[data-method="${state.activeMethod}"]`).click();
            
            if (state.validEmails.length > 0) {
                elements.emailPreview.querySelector('p').classList.add('hidden');
                elements.emailLists.classList.remove('hidden');
                elements.stats.classList.remove('hidden');
                elements.copyAllBtn.classList.remove('hidden');
                elements.sendAllBtn.classList.remove('hidden');
            }
        }
    }

    // Save current state to localStorage
    function saveState() {
        state.subject = elements.subjectInput.value;
        state.message = elements.messageInput.value;
        state.fileName = elements.fileNameDisplay.textContent;
        state.manualEmails = elements.manualEmailsTextarea.value;
        state.activeMethod = document.querySelector('.method-tab.active').dataset.method;
        
        const stateToSave = {
            ...state,
            clickedEmails: Array.from(state.clickedEmails)
        };
        
        localStorage.setItem('finesseEmailBulkerState', JSON.stringify(stateToSave));
    }

    // Set up event listeners
    function setupEventListeners() {
        elements.csvFileInput.addEventListener('change', handleFileSelect);
        
        elements.methodTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                elements.methodTabs.forEach(t => t.classList.remove('active'));
                elements.csvInput.classList.remove('active');
                elements.manualInput.classList.remove('active');
                
                this.classList.add('active');
                const method = this.dataset.method;
                document.getElementById(`${method}Input`).classList.add('active');
                state.activeMethod = method;
                saveState();
            });
        });
        
        elements.processBtn.addEventListener('click', processEmails);
        elements.clearBtn.addEventListener('click', clearAll);
        elements.copyAllBtn.addEventListener('click', copyAllEmails);
        elements.sendAllBtn.addEventListener('click', sendAllEmails);
        elements.sendGmailBtn.addEventListener('click', () => sendBatch(state.gmailEmails));
        elements.sendOtherBtn.addEventListener('click', () => sendBatch(state.nonGmailEmails));
        
        elements.subjectInput.addEventListener('input', saveState);
        elements.messageInput.addEventListener('input', saveState);
        elements.manualEmailsTextarea.addEventListener('input', saveState);
    }

    // Handle file selection
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            state.fileName = file.name;
            elements.fileNameDisplay.textContent = file.name;
        } else {
            state.fileName = 'No file selected';
            elements.fileNameDisplay.textContent = 'No file selected';
        }
        saveState();
    }

    // Process emails based on active method
    function processEmails() {
        const activeMethod = document.querySelector('.method-tab.active').dataset.method;
        
        if (activeMethod === 'csv') {
            processCSV();
        } else {
            processManualEmails();
        }
    }

    // Process CSV file
    function processCSV() {
        const file = elements.csvFileInput.files[0];
        if (!file) {
            alert('Please select a CSV file first.');
            return;
        }
        
        showLoading();
        
        const reader = new FileReader();
        reader.onload = function(e) {
            parseCSV(e.target.result);
            hideLoading();
        };
        reader.onerror = function() {
            alert('Error reading file');
            hideLoading();
        };
        reader.readAsText(file);
    }

    // Process manually entered emails
    function processManualEmails() {
        const manualText = elements.manualEmailsTextarea.value.trim();
        if (!manualText) {
            alert('Please enter some email addresses.');
            return;
        }
        
        showLoading();
        
        setTimeout(() => {
            parseManualEmails(manualText);
            hideLoading();
        }, 50);
    }

    // Show loading indicator
    function showLoading() {
        elements.loading.classList.remove('hidden');
        elements.emailPreview.querySelector('p').classList.add('hidden');
    }

    // Hide loading indicator
    function hideLoading() {
        elements.loading.classList.add('hidden');
    }

    // Parse CSV content
    function parseCSV(csvContent) {
        state.validEmails = [];
        state.invalidEmails = [];
        state.gmailEmails = [];
        state.nonGmailEmails = [];
        
        const lines = csvContent.split(/\r?\n/).filter(line => line.trim() !== '');
        
        if (lines.length === 0) {
            alert('CSV file is empty');
            return;
        }
        
        const hasHeaders = lines[0].toLowerCase().includes('email') || 
                         lines[0].toLowerCase().includes('name');
        const startRow = hasHeaders ? 1 : 0;
        
        for (let i = startRow; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line === '') continue;
            
            const columns = line.split(',');
            let email = '';
            let name = '';
            
            for (let col of columns) {
                col = col.trim().replace(/^"(.*)"$/, '$1');
                
                if (!email && isValidEmail(col)) {
                    email = col;
                } else if (!name && col && !isValidEmail(col)) {
                    name = col;
                }
            }
            
            if (email === '') {
                state.invalidEmails.push({email: line, name: ''});
                continue;
            }
            
            if (isValidEmail(email)) {
                const emailObj = {email, name};
                state.validEmails.push(emailObj);
                
                if (email.toLowerCase().endsWith('@gmail.com')) {
                    state.gmailEmails.push(emailObj);
                } else {
                    state.nonGmailEmails.push(emailObj);
                }
            } else {
                state.invalidEmails.push({email, name});
            }
        }
        
        updateEmailUI();
        saveState();
    }

    // Parse manually entered emails
    function parseManualEmails(text) {
        state.validEmails = [];
        state.invalidEmails = [];
        state.gmailEmails = [];
        state.nonGmailEmails = [];
        
        const entries = text.split(/[\n,]+/)
                          .map(e => e.trim())
                          .filter(e => e !== '');
        
        for (const entry of entries) {
            let email = '';
            let name = '';
            
            const parts = entry.split(/[\s,]+/).filter(p => p !== '');
            
            for (const part of parts) {
                if (!email && isValidEmail(part)) {
                    email = part;
                } else if (!name && part) {
                    name = part;
                }
            }
            
            if (!email) {
                state.invalidEmails.push({email: entry, name: ''});
                continue;
            }
            
            const emailObj = {email, name};
            if (isValidEmail(email)) {
                state.validEmails.push(emailObj);
                
                if (email.toLowerCase().endsWith('@gmail.com')) {
                    state.gmailEmails.push(emailObj);
                } else {
                    state.nonGmailEmails.push(emailObj);
                }
            } else {
                state.invalidEmails.push(emailObj);
            }
        }
        
        updateEmailUI();
        saveState();
    }

    // Update the email lists UI
    function updateEmailUI() {
        elements.gmailList.innerHTML = '';
        elements.nonGmailList.innerHTML = '';
        
        state.gmailEmails.forEach(emailObj => {
            createEmailElement(emailObj, elements.gmailList);
        });
        
        state.nonGmailEmails.forEach(emailObj => {
            createEmailElement(emailObj, elements.nonGmailList);
        });
        
        elements.gmailCountSpan.textContent = state.gmailEmails.length;
        elements.nonGmailCountSpan.textContent = state.nonGmailEmails.length;
        elements.gmailCountStat.textContent = state.gmailEmails.length;
        elements.nonGmailCountStat.textContent = state.nonGmailEmails.length;
        
        elements.totalEmailsSpan.textContent = state.validEmails.length + state.invalidEmails.length;
        elements.validEmailsSpan.textContent = state.validEmails.length;
        elements.invalidEmailsSpan.textContent = state.invalidEmails.length;
        elements.clickedEmailsSpan.textContent = state.clickedEmails.size;
        
        elements.emailLists.classList.remove('hidden');
        elements.stats.classList.remove('hidden');
        elements.copyAllBtn.classList.remove('hidden');
        elements.sendAllBtn.classList.remove('hidden');
        elements.emailPreview.querySelector('p').classList.add('hidden');
    }

    // Create an email list element
    function createEmailElement(emailObj, container) {
        const emailItem = document.createElement('div');
        emailItem.className = 'email-item';
        
        // Personalize both subject and body
        let subject = state.subject;
        let body = state.message;
        
        if (emailObj.name) {
            subject = subject.replace(/{name}/g, emailObj.name);
            body = body.replace(/{name}/g, emailObj.name);
        } else {
            const emailPrefix = emailObj.email.split('@')[0];
            subject = subject.replace(/{name}/g, emailPrefix);
            body = body.replace(/{name}/g, emailPrefix);
        }
        
        const encodedSubject = encodeURIComponent(subject);
        const encodedBody = encodeURIComponent(body);
        
        const mailtoLink = `mailto:${emailObj.email}?subject=${encodedSubject}&body=${encodedBody}`;
        
        const link = document.createElement('a');
        link.href = mailtoLink;
        link.className = `email-link ${state.clickedEmails.has(emailObj.email) ? 'clicked' : ''}`;
        link.textContent = emailObj.email;
        link.target = '_blank';
        
        if (emailObj.name) {
            link.textContent += ` (${emailObj.name})`;
        }
        
        link.addEventListener('click', (e) => {
            if (!state.clickedEmails.has(emailObj.email)) {
                state.clickedEmails.add(emailObj.email);
                link.classList.add('clicked');
                elements.clickedEmailsSpan.textContent = state.clickedEmails.size;
                saveState();
            }
        });
        
        emailItem.appendChild(link);
        container.appendChild(emailItem);
    }

    // Copy all emails to clipboard
    function copyAllEmails() {
        if (state.validEmails.length === 0) {
            alert('No valid emails to copy.');
            return;
        }
        
        const emailList = state.validEmails.map(item => item.email).join(', ');
        
        navigator.clipboard.writeText(emailList).then(() => {
            alert(`${state.validEmails.length} emails copied to clipboard!`);
        }, () => {
            const textarea = document.createElement('textarea');
            textarea.value = emailList;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert(`${state.validEmails.length} emails copied to clipboard!`);
        });
    }

    // Send all emails
    function sendAllEmails() {
        if (state.validEmails.length === 0) {
            alert('No valid emails to send.');
            return;
        }
        sendBatch(state.validEmails);
    }

    // Send a batch of emails
    function sendBatch(emails) {
        if (emails.length === 0) {
            alert('No emails to send in this batch.');
            return;
        }
        
        const chunkSize = 100;
        const chunks = [];
        
        for (let i = 0; i < emails.length; i += chunkSize) {
            chunks.push(emails.slice(i, i + chunkSize));
        }
        
        sendEmailChunks(chunks, 0);
    }

    // Send email chunks sequentially
    function sendEmailChunks(chunks, index) {
        if (index >= chunks.length) {
            alert(`All emails (${chunks.flat().length}) have been processed!`);
            return;
        }
        
        const currentChunk = chunks[index];
        const emails = currentChunk.map(item => item.email);
        const bccList = emails.slice(1).join(',');
        
        // Personalize for first recipient
        let subject = state.subject;
        let body = state.message;
        
        if (currentChunk[0].name) {
            subject = subject.replace(/{name}/g, currentChunk[0].name);
            body = body.replace(/{name}/g, currentChunk[0].name);
        } else {
            const emailPrefix = currentChunk[0].email.split('@')[0];
            subject = subject.replace(/{name}/g, emailPrefix);
            body = body.replace(/{name}/g, emailPrefix);
        }
        
        const encodedSubject = encodeURIComponent(subject);
        const encodedBody = encodeURIComponent(body);
        
        const mailtoLink = `mailto:${emails[0]}${bccList ? `?to=${bccList}` : ''}&subject=${encodedSubject}&body=${encodedBody}`;
        
        window.open(mailtoLink, '_blank');
        
        emails.forEach(email => {
            state.clickedEmails.add(email);
        });
        
        elements.clickedEmailsSpan.textContent = state.clickedEmails.size;
        saveState();
        
        const links = document.querySelectorAll('.email-link');
        links.forEach(link => {
            const email = link.textContent.split(' (')[0];
            if (state.clickedEmails.has(email)) {
                link.classList.add('clicked');
            }
        });
        
        const confirmed = confirm(`Batch ${index + 1} of ${chunks.length} (${currentChunk.length} recipients) has been opened. Click OK when you've sent this email to proceed to the next batch.`);
        if (confirmed) {
            sendEmailChunks(chunks, index + 1);
        }
    }

    // Validate email format
    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    // Clear all data
    function clearAll() {
        state.validEmails = [];
        state.invalidEmails = [];
        state.gmailEmails = [];
        state.nonGmailEmails = [];
        state.clickedEmails = new Set();
        state.subject = '';
        state.message = '';
        state.fileName = 'No file selected';
        state.manualEmails = '';
        state.activeMethod = 'csv';
        
        elements.csvFileInput.value = '';
        elements.fileNameDisplay.textContent = 'No file selected';
        elements.subjectInput.value = '';
        elements.messageInput.value = '';
        elements.manualEmailsTextarea.value = '';
        elements.emailLists.classList.add('hidden');
        elements.stats.classList.add('hidden');
        elements.copyAllBtn.classList.add('hidden');
        elements.sendAllBtn.classList.add('hidden');
        elements.emailPreview.querySelector('p').classList.remove('hidden');
        
        document.querySelector('.method-tab[data-method="csv"]').click();
        
        localStorage.removeItem('finesseEmailBulkerState');
        
        elements.totalEmailsSpan.textContent = '0';
        elements.validEmailsSpan.textContent = '0';
        elements.invalidEmailsSpan.textContent = '0';
        elements.gmailCountSpan.textContent = '0';
        elements.nonGmailCountSpan.textContent = '0';
        elements.gmailCountStat.textContent = '0';
        elements.nonGmailCountStat.textContent = '0';
        elements.clickedEmailsSpan.textContent = '0';
    }

    // Initialize the application
    init();
});
    </script>
</body>
</html>
