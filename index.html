<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finesse Email Bulker</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --accent-color: #ea4335;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .tagline {
            color: var(--dark-gray);
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .form-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .preview-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: block;
            padding: 12px;
            background-color: var(--light-gray);
            border: 2px dashed #ccc;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-label:hover {
            background-color: #e9e9e9;
            border-color: var(--primary-color);
        }
        
        .file-name {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3367d6;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: #2d9249;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #d33426;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .email-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 20px;
            background-color: var(--light-gray);
        }
        
        .email-item {
            padding: 8px;
            margin-bottom: 5px;
            background-color: white;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .email-item:last-child {
            margin-bottom: 0;
        }
        
        .email-link {
            color: var(--primary-color);
            text-decoration: none;
            word-break: break-all;
        }
        
        .email-link:hover {
            text-decoration: underline;
        }
        
        .email-link.clicked {
            color: var(--accent-color);
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f0fe;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .stats p {
            margin-bottom: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .help-text {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Finesse Email Bulker</h1>
            <p class="tagline">Efficiently send bulk emails with ease</p>
        </header>
        
        <div class="main-content">
            <section class="form-section">
                <h2>Compose Your Email</h2>
                
                <div class="form-group">
                    <label for="subject">Subject Line</label>
                    <input type="text" id="subject" placeholder="Enter your email subject">
                </div>
                
                <div class="form-group">
                    <label for="message">Message Body</label>
                    <textarea id="message" placeholder="Enter your email message"></textarea>
                    <p class="help-text">Use {name} to personalize the message with recipient's name</p>
                </div>
                
                <div class="form-group">
                    <label for="csvFile">Upload CSV File</label>
                    <input type="file" id="csvFile" accept=".csv" class="file-input">
                    <label for="csvFile" class="file-label">
                        Choose CSV File
                    </label>
                    <div id="fileName" class="file-name">No file selected</div>
                    <p class="help-text">CSV should contain at least email addresses. Include 'name' column for personalization.</p>
                </div>
                
                <div class="button-group">
                    <button id="processBtn" class="btn">Process Emails</button>
                    <button id="clearBtn" class="btn btn-accent">Clear All</button>
                </div>
            </section>
            
            <section class="preview-section">
                <h2>Email Preview</h2>
                
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Processing emails...</p>
                </div>
                
                <div id="emailPreview">
                    <p>Upload a CSV file to preview emails.</p>
                    <div id="emailList" class="email-list hidden"></div>
                    
                    <div id="stats" class="stats hidden">
                        <p><strong>Total Emails:</strong> <span id="totalEmails">0</span></p>
                        <p><strong>Valid Emails:</strong> <span id="validEmails">0</span></p>
                        <p><strong>Invalid Emails:</strong> <span id="invalidEmails">0</span></p>
                        <p><strong>Clicked Emails:</strong> <span id="clickedEmails">0</span></p>
                    </div>
                    
                    <div class="button-group">
                        <button id="copyAllBtn" class="btn btn-secondary hidden">Copy All Emails (BCC)</button>
                        <button id="sendAllBtn" class="btn hidden">Send All Emails</button>
                    </div>
                </div>
            </section>
        </div>
        
        <footer>
            <p>Finesse Email Bulker &copy; 2025 | Designed for efficient bulk emailing</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const csvFileInput = document.getElementById('csvFile');
    const fileNameDisplay = document.getElementById('fileName');
    const processBtn = document.getElementById('processBtn');
    const clearBtn = document.getElementById('clearBtn');
    const copyAllBtn = document.getElementById('copyAllBtn');
    const sendAllBtn = document.getElementById('sendAllBtn');
    const emailList = document.getElementById('emailList');
    const loading = document.getElementById('loading');
    const emailPreview = document.getElementById('emailPreview');
    const stats = document.getElementById('stats');
    const totalEmailsSpan = document.getElementById('totalEmails');
    const validEmailsSpan = document.getElementById('validEmails');
    const invalidEmailsSpan = document.getElementById('invalidEmails');
    const clickedEmailsSpan = document.getElementById('clickedEmails');
    const subjectInput = document.getElementById('subject');
    const messageInput = document.getElementById('message');
    
    // Variables to store email data
    let emailData = [];
    let validEmails = [];
    let invalidEmails = [];
    let clickedEmails = new Set();
    
    // Event Listeners
    csvFileInput.addEventListener('change', handleFileSelect);
    processBtn.addEventListener('click', processEmails);
    clearBtn.addEventListener('click', clearAll);
    copyAllBtn.addEventListener('click', copyAllEmails);
    sendAllBtn.addEventListener('click', sendAllEmails);
    
    // Functions
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            fileNameDisplay.textContent = file.name;
        } else {
            fileNameDisplay.textContent = 'No file selected';
        }
    }
    
    function processEmails() {
        const file = csvFileInput.files[0];
        if (!file) {
            alert('Please select a CSV file first.');
            return;
        }
        
        loading.classList.remove('hidden');
        emailPreview.querySelector('p').classList.add('hidden');
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            parseCSV(content);
        };
        reader.readAsText(file);
    }
    
    function parseCSV(csvContent) {
        emailData = [];
        validEmails = [];
        invalidEmails = [];
        clickedEmails = new Set();
        
        // Split CSV into lines
        const lines = csvContent.split(/\r?\n/);
        
        if (lines.length === 0) {
            alert('CSV file is empty');
            loading.classList.add('hidden');
            return;
        }
        
        // Process each line
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].trim() === '') continue;
            
            const columns = lines[i].split(',');
            
            // Find potential email in all columns
            let email = '';
            let name = '';
            
            for (let col of columns) {
                col = col.trim().replace(/^"(.*)"$/, '$1');
                
                if (!email && isValidEmail(col)) {
                    email = col;
                } else if (!name && col && !isValidEmail(col)) {
                    // Use first non-email column as name
                    name = col;
                }
            }
            
            if (email === '') {
                invalidEmails.push({email: columns.join(','), name: ''});
                continue;
            }
            
            if (isValidEmail(email)) {
                validEmails.push({email, name});
            } else {
                invalidEmails.push({email, name});
            }
        }
        
        // Update UI
        updateEmailList();
        
        loading.classList.add('hidden');
        emailList.classList.remove('hidden');
        stats.classList.remove('hidden');
        copyAllBtn.classList.remove('hidden');
        sendAllBtn.classList.remove('hidden');
        
        totalEmailsSpan.textContent = validEmails.length + invalidEmails.length;
        validEmailsSpan.textContent = validEmails.length;
        invalidEmailsSpan.textContent = invalidEmails.length;
        clickedEmailsSpan.textContent = clickedEmails.size;
    }
    
    function isValidEmail(email) {
        // Simple email validation regex
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    
    function updateEmailList() {
        emailList.innerHTML = '';
        
        // Display up to 100 emails (for performance)
        const displayCount = Math.min(validEmails.length, 200);
        
        for (let i = 0; i < displayCount; i++) {
            const {email, name} = validEmails[i];
            const emailItem = document.createElement('div');
            emailItem.className = 'email-item';
            
            const subject = encodeURIComponent(subjectInput.value);
            let body = messageInput.value;
            
            // Replace {name} with actual name if available, or with email prefix if not
            if (name) {
                body = body.replace(/{name}/g, name);
            } else {
                // Use email prefix (before @) as name if no name available
                const emailPrefix = email.split('@')[0];
                body = body.replace(/{name}/g, emailPrefix);
            }
            body = encodeURIComponent(body);
            
            const mailtoLink = `mailto:${email}?subject=${subject}&body=${body}`;
            
            const link = document.createElement('a');
            link.href = mailtoLink;
            link.className = `email-link ${clickedEmails.has(email) ? 'clicked' : ''}`;
            link.textContent = email;
            link.target = '_blank';
            
            // Add name if available
            if (name) {
                link.textContent += ` (${name})`;
            }
            
            link.addEventListener('click', function(e) {
                if (!clickedEmails.has(email)) {
                    clickedEmails.add(email);
                    clickedEmailsSpan.textContent = clickedEmails.size;
                    this.classList.add('clicked');
                    
                    // Store clicked state in localStorage
                    const clickedEmailsStorage = JSON.parse(localStorage.getItem('clickedEmails') || '[]');
                    clickedEmailsStorage.push(email);
                    localStorage.setItem('clickedEmails', JSON.stringify(clickedEmailsStorage));
                }
            });
            
            emailItem.appendChild(link);
            emailList.appendChild(emailItem);
        }
        
        if (validEmails.length > 20000) {
            const moreItem = document.createElement('div');
            moreItem.className = 'email-item';
            moreItem.textContent = `+ ${validEmails.length - 100} more emails...`;
            emailList.appendChild(moreItem);
        }
        
        // Load previously clicked emails from localStorage
        loadClickedEmails();
    }
    
    function loadClickedEmails() {
        const clickedEmailsStorage = JSON.parse(localStorage.getItem('clickedEmails') || '[]');
        clickedEmails = new Set(clickedEmailsStorage);
        clickedEmailsSpan.textContent = clickedEmails.size;
        
        // Update UI for displayed emails
        const links = emailList.querySelectorAll('.email-link');
        links.forEach(link => {
            const email = link.textContent.split(' (')[0]; // Extract email from link text
            if (clickedEmails.has(email)) {
                link.classList.add('clicked');
            }
        });
    }
    
    function copyAllEmails() {
        if (validEmails.length === 0) {
            alert('No valid emails to copy.');
            return;
        }
        
        // Create comma-separated list for BCC
        const emailList = validEmails.map(item => item.email).join(', ');
        
        // Copy to clipboard
        navigator.clipboard.writeText(emailList).then(function() {
            alert(`${validEmails.length} emails copied to clipboard! You can paste them in the BCC field.`);
        }, function() {
            // Fallback if clipboard API fails
            const textarea = document.createElement('textarea');
            textarea.value = emailList;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert(`${validEmails.length} emails copied to clipboard! You can paste them in the BCC field.`);
        });
    }
    
    function sendAllEmails() {
        if (validEmails.length === 0) {
            alert('No valid emails to send.');
            return;
        }
        
        const subject = encodeURIComponent(subjectInput.value);
        let body = messageInput.value;
        
        // For large numbers of emails, we'll use BCC with a reasonable chunk size
        const chunkSize = 200; // Gmail has a limit on BCC recipients
        const emailChunks = chunkArray(validEmails, chunkSize);
        
        // Send first chunk immediately
        sendEmailChunk(emailChunks, 0, subject, body);
    }
    
    function sendEmailChunk(chunks, index, subject, body) {
        if (index >= chunks.length) {
            alert(`All emails (${validEmails.length}) have been processed!`);
            return;
        }
        
        const currentChunk = chunks[index];
        const emails = currentChunk.map(item => item.email);
        const bccList = emails.join(',');
        
        // Personalize body for first recipient
        let personalizedBody = body;
        const {email, name} = currentChunk[0];
        if (name) {
            personalizedBody = personalizedBody.replace(/{name}/g, name);
        } else {
            // Use email prefix (before @) as name if no name available
            const emailPrefix = email.split('@')[0];
            personalizedBody = personalizedBody.replace(/{name}/g, emailPrefix);
        }
        personalizedBody = encodeURIComponent(personalizedBody);
        
        // Create mailto link with first email in To and rest in BCC
        const mailtoLink = `mailto:${emails[0]}?bcc=${bccList}&subject=${subject}&body=${personalizedBody}`;
        
        // Open email client
        window.location.href = mailtoLink;
        
        // Mark all emails in this chunk as clicked
        emails.forEach(email => {
            if (!clickedEmails.has(email)) {
                clickedEmails.add(email);
                clickedEmailsSpan.textContent = clickedEmails.size;
                
                // Store clicked state in localStorage
                const clickedEmailsStorage = JSON.parse(localStorage.getItem('clickedEmails') || '[]');
                clickedEmailsStorage.push(email);
                localStorage.setItem('clickedEmails', JSON.stringify(clickedEmailsStorage));
            }
        });
        
        // Update UI
        const links = emailList.querySelectorAll('.email-link');
        links.forEach(link => {
            const email = link.textContent.split(' (')[0]; // Extract email from link text
            if (clickedEmails.has(email)) {
                link.classList.add('clicked');
            }
        });
        
        // In a real implementation, you would need a way to detect when the user
        // has finished sending the current chunk before proceeding to the next
        // For demo purposes, we'll use a confirmation
        const confirmed = confirm(`Chunk ${index + 1} of ${chunks.length} (${currentChunk.length} recipients) has been opened. Click OK when you've sent this email to proceed to the next chunk.`);
        
        if (confirmed) {
            sendEmailChunk(chunks, index + 1, subject, body);
        }
    }
    
    function chunkArray(array, size) {
        const chunks = [];
        for (let i = 0; i < array.length; i += size) {
            chunks.push(array.slice(i, i + size));
        }
        return chunks;
    }
    
    function clearAll() {
        csvFileInput.value = '';
        fileNameDisplay.textContent = 'No file selected';
        emailList.innerHTML = '';
        emailList.classList.add('hidden');
        stats.classList.add('hidden');
        copyAllBtn.classList.add('hidden');
        sendAllBtn.classList.add('hidden');
        emailPreview.querySelector('p').classList.remove('hidden');
        subjectInput.value = '';
        messageInput.value = '';
        emailData = [];
        validEmails = [];
        invalidEmails = [];
        clickedEmails = new Set();
        clickedEmailsSpan.textContent = '0';
    }
    
    // Watch for changes in subject or message to update mailto links
    subjectInput.addEventListener('input', updateEmailList);
    messageInput.addEventListener('input', updateEmailList);
    
    // Load any previously clicked emails when page loads
    window.addEventListener('load', loadClickedEmails);
});
    </script>
</body>
</html>
